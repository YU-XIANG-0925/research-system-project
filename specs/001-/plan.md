# 實作計畫：演講能力輔助系統

**分支**：`001-` | **日期**：2025-09-12 | **規格書**：[spec.md](spec.md)
**輸入**：來自 `/specs/001-/spec.md` 的功能規格書

## 執行流程 (/plan 命令範圍)
```
1. 從輸入路徑載入功能規格書
   → 若找不到：錯誤 "在 {path} 找不到功能規格書"
2. 填寫技術背景 (掃描 [需要釐清] 的項目)
   → 從背景偵測專案類型 (web=前端+後端, mobile=app+api)
   → 根據專案類型設定結構決策
3. 評估下方的「章程檢查」部分
   → 若存在違規：在「複雜度追蹤」中記錄
   → 若無法提出正當理由：錯誤 "請先簡化方法"
   → 更新進度追蹤：初始章程檢查
4. 執行階段 0 → research.md
   → 若仍有 [需要釐清] 的項目：錯誤 "請解決未知問題"
5. 執行階段 1 → contracts, data-model.md, quickstart.md, 特定代理的範本檔案 (例如，Claude Code 的 `CLAUDE.md`，GitHub Copilot 的 `.github/copilot-instructions.md`，或 Gemini CLI 的 `GEMINI.md`)。
6. 重新評估「章程檢查」部分
   → 若有新的違規：重構設計，返回階段 1
   → 更新進度追蹤：設計後章程檢查
7. 規劃階段 2 → 描述任務生成方法 (不要建立 tasks.md)
8. 停止 - 已準備好執行 /tasks 命令
```

**重要**：/plan 命令在步驟 7 停止。階段 2-4 由其他命令執行：
- 階段 2：/tasks 命令建立 tasks.md
- 階段 3-4：實作執行 (手動或透過工具)

## 摘要
此專案是一個演講能力輔助系統，旨在幫助使用者提升簡報技巧。它涉及上傳講稿、獲得手勢和情緒的自動建議、編輯它們，以及使用帶有即時提示的提詞器。該系統將採用原生 Web 技術建構的前端和使用 FastAPI 的 Python 後端。它還將透過 MQTT 與外部硬體 (機器人) 整合。

## 技術背景
**語言/版本**：Python 3.11+, JavaScript (ES6+)
**主要依賴套件**：FastAPI, uvicorn, httpx, opencv-python, mediapipe, paho-mqtt
**儲存**：用於講稿和使用者資料的檔案。
**測試**：pytest
**目標平台**：支援 Web Audio API 的網頁瀏覽器。
**專案類型**：Web 應用程式 (前端 + 後端)
**效能目標**：演講期間的即時回饋 (提示延遲 <500ms)。
**限制**：必須支援標準網頁瀏覽器。
**規模/範圍**：初期為單使用者會話。

## 章程檢查
*閘門：必須在階段 0 研究之前通過。在階段 1 設計之後重新檢查。*

**簡潔性**：
- 專案數量：2 (前端, 後端)
- 直接使用框架？是
- 單一資料模型？是
- 避免設計模式？是

**架構**：
- 每個功能都作為函式庫？否，這是一個 Web 應用程式。
- 列出的函式庫：無
- 每個函式庫的 CLI：無
- 函式庫文件：無

**測試 (不可協商)**：
- 強制執行紅-綠-重構循環？是
- Git 提交是否在實作前顯示測試？是
- 嚴格遵循合約→整合→E2E→單元測試的順序？是
- 使用真實依賴？是 (實際的資料庫，非模擬)
- 整合測試涵蓋：新函式庫、合約變更、共享結構？是
- 禁止：在測試前實作、跳過紅燈階段。是

**可觀察性**：
- 包含結構化日誌？是
- 前端日誌 → 後端？是 (統一的日誌流)
- 錯誤上下文是否足夠？是

**版本控制**：
- 已分配版本號？0.1.0
- 每次變更都增加 BUILD 版本號？是
- 處理破壞性變更？是

## 專案結構

### 文件 (此功能)
```
specs/[###-feature]/
├── plan.md              # 此檔案 (/plan 命令輸出)
├── research.md          # 階段 0 輸出 (/plan 命令)
├── data-model.md        # 階段 1 輸出 (/plan 命令)
├── quickstart.md        # 階段 1 輸出 (/plan 命令)
├── contracts/           # 階段 1 輸出 (/plan 命令)
└── tasks.md             # 階段 2 輸出 (/tasks 命令 -不由 /plan 建立)
```

### 原始碼 (儲存庫根目錄)
```
# 選項 2：Web 應用程式 (當偵測到 "前端" + "後端" 時)
backend/
├── src/
│   ├── models/
│   ├── services/
│   └── api/
└── tests/

frontend/
├── src/
│   ├── components/
│   ├── pages/
│   └── services/
└── tests/
```

**結構決策**：選項 2：Web 應用程式

## 階段 0：大綱與研究
1. **從上述技術背景中提取未知數**：
   - 對於每個 [需要釐清] → 研究任務
   - 對於每個依賴 → 最佳實踐任務
   - 對於每個整合 → 模式任務

2. **生成並派遣研究代理**：
   ```
   對於技術背景中的每個未知數：
     任務："研究 {未知數} 用於 {功能背景}"
   對於每個技術選擇：
     任務："尋找 {技術} 在 {領域} 的最佳實踐"
   ```

3. **在 `research.md` 中整合研究結果**，使用以下格式：
   - 決策：[選擇了什麼]
   - 理由：[為什麼選擇]
   - 考慮過的替代方案：[評估了哪些其他方案]

**輸出**：`research.md`，其中所有 [需要釐清] 的問題都已解決

## 階段 1：設計與合約
*先決條件：research.md 已完成*

1. **從功能規格書中提取實體** → `data-model.md`：
   - 實體名稱、欄位、關係
   - 來自需求的驗證規則
   - 狀態轉換 (如果適用)

2. **從功能性需求生成 API 合約**：
   - 每個使用者操作 → 一個端點
   - 使用標準的 REST/GraphQL 模式
   - 將 OpenAPI/GraphQL 結構輸出到 `/contracts/`

3. **從合約生成合約測試**：
   - 每個端點一個測試檔案
   - 斷言請求/回應的結構
   - 測試必須失敗 (因為尚未實作)

4. **從使用者故事中提取測試情境**：
   - 每個故事 → 一個整合測試情境
   - 快速入門測試 = 故事驗證步驟

5. **增量更新代理檔案** (O(1) 操作)：
   - 為您的 AI 助理執行 `/scripts/update-agent-context.sh [claude|gemini|copilot]`
   - 如果存在：僅從當前計畫中添加新技術
   - 在標記之間保留手動添加的內容
   - 更新最近的變更 (保留最近 3 次)
   - 保持在 150 行以下以提高 token 效率
   - 輸出到儲存庫根目錄

**輸出**：data-model.md, /contracts/*, 失敗的測試, quickstart.md, 特定代理的檔案

## 階段 2：任務規劃方法
*本節描述 /tasks 命令將執行的操作 - 不在 /plan 期間執行*

**任務生成策略**：
- 載入 `/templates/tasks-template.md` 作為基礎
- 從階段 1 的設計文件 (合約、資料模型、快速入門) 生成任務
- 每個合約 → 合約測試任務 [P]
- 每個實體 → 模型建立任務 [P]
- 每個使用者故事 → 整合測試任務
- 使測試通過的實作任務

**排序策略**：
- TDD 順序：測試先於實作
- 依賴順序：模型先於服務，服務先於 UI
- 標記 [P] 表示可並行執行 (獨立檔案)

**預期輸出**：在 tasks.md 中有 25-30 個編號且排序的任務

**重要**：此階段由 /tasks 命令執行，而非 /plan

## 階段 3+：未來實作
*這些階段超出了 /plan 命令的範圍*

**階段 3**：任務執行 (/tasks 命令建立 tasks.md)
**階段 4**：實作 (遵循章程原則執行 tasks.md)
**階段 5**：驗證 (運行測試，執行 quickstart.md，效能驗證)

## 複雜度追蹤
*僅在章程檢查有必須證明的違規時填寫*

| 違規 | 為何需要 | 拒絕更簡單替代方案的原因 |
|-----------|------------|-------------------------------------|
| [例如，第 4 個專案] | [當前需求] | [為何 3 個專案不足] |
| [例如，儲存庫模式] | [特定問題] | [為何直接存取資料庫不足] |


## 進度追蹤
*此檢查表在執行流程中更新*

**階段狀態**：
- [x] 階段 0：研究完成 (/plan 命令)
- [x] 階段 1：設計完成 (/plan 命令)
- [x] 階段 2：任務規劃完成 (/plan 命令 - 僅描述方法)
- [ ] 階段 3：任務已生成 (/tasks 命令)
- [ ] 階段 4：實作完成
- [ ] 階段 5：驗證通過

**閘門狀態**：
- [x] 初始章程檢查：通過
- [x] 設計後章程檢查：通過
- [x] 所有 [需要釐清] 已解決
- [x] 複雜度偏差已記錄

---
*基於章程 v2.1.1 - 請參閱 `/.specify/memory/constitution.md`*
